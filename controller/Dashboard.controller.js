sap.ui.define(["sap/ui/core/mvc/Controller","./BaseController","sap/ui/model/odata/v2/ODataModel","sap/ui/core/util/MockServer","sap/ui/model/Filter","sap/ui/model/FilterOperator"],function(e,t,a,o,i,r){"use strict";return t.extend("alfa.com.co.zui5_gestioncotizaciones.controller.Dashboard",{onInit:function(){this.getODataManager().getDataPromise("","/UsuarioSet",[]).then(e=>{var t=e.results[0].User;this.getModel("user2").setProperty("/userGw",t)});setTimeout(()=>{console.log(this.getModel("user2").getProperty("/userGw"))},5e3);var e=this.getView().byId("smartFilterBar");var t=e.getControlByKey("Erdat");var a=sap.ui.core.format.DateFormat.getDateInstance({pattern:"YYYY-MM-dd"});var o=new Date;o.setMonth(o.getMonth()-2);var i=a.format(o);var r=new sap.m.Token({key:"Erdat",text:">="+i,tooltip:">="+i})},onBeforeRebindTable:function(e){},onBeforeExport:function(e){var t=e.getParameter("exportSettings");t.worker=false},onColumns:function(){var e=this._getSmartTable();if(e){e.openPersonalisationDialog("Columns")}},_getSmartTable:function(){if(!this._oSmartTable){this._oSmartTable=this.getView().byId("CotizacionesSmartTable")}return this._oSmartTable},onDetail:function(e){var t=e.getSource().getBindingContext().getObject();this.getModel("detail").setProperty("/Vbeln",t.Vbeln);this.getRouter().navTo("Detail")},onActivities:function(e){var t=e.getSource().getCustomData()[0].getValue("Vbeln"),a=new i("Cotizacion",r.EQ,t);this.getView().setBusy(true);this.getODataManager().getDataPromise("","/ActividadesSet",[a]).then(e=>{this.getModel("detail").setProperty("/Activities",e.results);this.getView().setBusy(false);this.getDialog("alfa.com.co.zui5_gestioncotizaciones.view.fragment.showActivities",false).open()})},onAddActivity:function(e){var t=e.getSource().getCustomData()[0].getValue("Vbeln"),a={Id:"0",Cotizacion:t,Fecha:new Date,Hora:new Date,Ultima:"X",Modificado:this.getModel("user").getProperty("/name"),Ultimaact:new Date,Fechaact:new Date,Horaact:new Date,Estado:"Activa"};this.getModel("activity").setProperty("/",a);this.getCreateDialog("alfa.com.co.zui5_gestioncotizaciones.view.fragment.createActivity",false).open()},onSave:function(e){var t=this.getModel("activity").getProperty("/"),a=sap.ui.core.format.DateFormat.getDateInstance({pattern:"PThh'H'mm'M'ss'S'"}),o=this.getModel().getProperty("/CotizSet('"+t.Cotizacion+"')");if(t.Fecha<o.Erdat){this.getMessageBox().error("La fecha de la actividad es menor a la creación de la cotización");return}this.getView().setBusy(true);if(t.Id==="0"){t.Hora=a.format(t.Hora);t.Horaact=a.format(t.Horaact)}this.getODataManager().saveData("",t,{success:function(e){this.getCreateDialog("",false).close();this.getModel().refresh(true);this.getMessageBox().show("Guardado correctamente");this.getView().setBusy(false)}.bind(this),error:function(e){this.getView().setBusy(false);this.getMessageBox().error("Ha ocurrido un error al cargar la información:"+e.responseText)}.bind(this)},{action:"create",sEntity:"/ActividadSet"},this)},onCloseDialog:function(e){this.getDialog("",false).close()},onClose:function(e){this.getCreateDialog("",false).close()},onSearch:function(e){}})});